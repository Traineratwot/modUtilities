{"version":3,"names":[],"mappings":"","sources":["assets/components/modutilities/js/mgr/snippet_rest.tab.min.js"],"sourcesContent":["\nExt.onReady(function(){Ext.util.Cookies.set('search_log','')\nMODx.add({xtype:'modUtil-panel-home'})\nhljs.initHighlightingOnLoad()\nsetTimeout(function(){document.querySelectorAll('pre code').forEach((block)=>{if(typeof hljs!='undefined'){hljs.highlightBlock(block)}})},1000)})\nvar entityMap={'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\\'':'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}\nvar modUtil=function(config){config=config||{}\nmodUtil.superclass.constructor.call(this,config)}\nExt.extend(modUtil,MODx.Component,{panel:{},page:{},window:{},grid:{},tree:{},combo:{},config:{},view:{},utils:{}})\nExt.reg('modUtil',modUtil)\nmodUtil=new modUtil()\nvar escapeHTML=function(string){var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\\'':'&#x27;','/':'&#x2F;'}\nvar htmlEscaper=/[&<>\"'\\/]/g\nreturn(''+string).replace(htmlEscaper,function(match){return htmlEscapes[match]})}\nvar defaultRenderer=function(val){console.debug(arguments)\nreturn val||_('ext_emptygroup')}\nvar JSONRenderer=function(val){if(val){try{return cope.Highlighter.highlight(JSON.parse(val),{indent:2,useTabs:true})}finally{return`<pre><code class=\"language-json\">${val}</code></pre>`}}\nreturn defaultRenderer(val)}\nfunction escapeHtml(string){return String(string).replace(/[&<>\"'`=\\/]/g,function(s){return entityMap[s]})}\nvar HTMLRenderer=function(val){if(val){var out=null\ntry{out=hljs.highlight('xml',val).value}catch(e){out='<code> '+escapeHtml(defaultRenderer(val))+' </code>'}\nreturn out}\nreturn defaultRenderer(val)}\nmodUtil.panel.Home=function(config){config=config||{}\nExt.apply(config,{cls:'container',items:[{html:' <h2>modUtil REST<small style=\"font-size: 10px\"><a href=\"https://forms.gle/FJbfBSutMJwQCgmS8\" target=\"_blank\">Bug report</a></small></h2><br><small style=\"color: red\">deprecated interface, please install <strong><a href="https://modstore.pro/packages/other/extraext">ExtraExt</a></strong> </small>',},{xtype:'modx-tabs',id:'main-modx-tabs',deferredRender:false,border:true,items:[{title:'Rest',id:'modx-tabs-Rest',items:[{html:'Methods',cls:'panel-desc',},{id:'Rest-main-table',xtype:'modUtil-grid',columns:[{dataIndex:'id',width:330,header:'id',sortable:true,renderer:defaultRenderer},{dataIndex:'url',width:670,header:'url',sortable:true,editor:{xtype:'textfield'},renderer:function(val){if(val){return`<a href=\"/${val}\" target=\"_blank\">${val}</a>`}else{return defaultRenderer(val)}}},{dataIndex:'snippet',width:670,header:_('snippet'),sortable:true,editor:{xtype:'modUtil-combo-modCombo',fieldLabel:_('snippet'),forceSelection:false,fields:['id','name','category_name'],url:MODx.config.connector_url,baseParams:{action:'element/snippet/getlist',sort:'id',dir:'DESK',combo:1,},valueField:'name',displayField:'name',tpl:new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{name}</strong><small>({category_name})</small>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t\t\t\t\t\t</tpl>',{compiled:true})},renderer:defaultRenderer},{dataIndex:'parameters',width:670,editor:{xtype:'textarea'},header:_('parameters'),renderer:JSONRenderer,editor:{xtype:'textarea'}},{dataIndex:'permission',width:670,header:_('permissions'),renderer:JSONRenderer,editor:{xtype:'textarea'},},{dataIndex:'allowMethod',width:670,sortable:true,header:_('modutilities.allowMethod'),renderer:defaultRenderer,editor:{xtype:'textfield'}},{dataIndex:'BASIC_auth',width:670,header:_('modutilities.BASIC_auth'),sortable:true,editor:{xtype:'combo-boolean'},renderer:function(val){if(val==1){val='<span class=\"true\">'+_('yes')+'</span>'}else{val='<span class=\"false\">'+_('no')+'</span>'}\nreturn val}},{dataIndex:'category',width:670,header:_('category'),editor:{xtype:'modUtil-combo-modCombo',name:'category',hiddenName:'category',fieldLabel:_('category'),forceSelection:false,fields:['id','name','allowMethod'],baseParams:{action:'mgr/rest/category/get',sort:'name',dir:'DESK',combo:1,},valueField:'name',displayField:'name',tpl:new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{name}</strong><small>({allowMethod})</small>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t\t\t\t\t\t</tpl>',{compiled:true})},renderer:defaultRenderer}],fields:['id','permission','url','snippet','param','allowMethod','BASIC_auth','category','catName',],tbar:[{xtype:'button',text:_('create_new')+' Rest',cls:'primary-button',handler:function(){MODx.load({xtype:'modUtil-window-addRest',}).show()},}],action:'mgr/rest/rest/get',save_action:'mgr/rest/rest/update',autosave:true,getMenu:function(grid,rowIndex){var m=[]\nm.push({text:_('delete'),grid:grid,rowIndex:rowIndex,handler:this.del})\nreturn m},del:function(){var cs=this.getSelectedAsList()\nvar self=this\nMODx.msg.confirm({title:_('delete'),text:_('confirm_remove'),url:modUtilConnector_url,params:{action:'mgr/rest/rest/delete',id:cs,},listeners:{'success':{fn:function(r){if(!r.success){MODx.msg.status({title:_('undeleted'),message:'ÐžÑˆÐ¸Ð±ÐºÐ°',delay:3})}else{MODx.msg.status({title:_('delete'),message:'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾',delay:3})}\nself.refresh()},scope:true}}})}}]},{title:'Category',id:'modx-tabs-Category',items:[{html:'Categories',cls:'panel-desc',},{id:'Category-main-table',xtype:'modUtil-grid',columns:[{dataIndex:'id',width:330,sortable:true,header:'id',renderer:defaultRenderer,},{dataIndex:'name',width:330,sortable:true,header:_('name'),renderer:defaultRenderer,editor:{xtype:'textfield'}},{dataIndex:'permission',width:670,header:_('permissions'),renderer:JSONRenderer,editor:{xtype:'textarea'},},{dataIndex:'param',width:670,header:_('parameters'),renderer:JSONRenderer,editor:{xtype:'textarea'},},{dataIndex:'allowMethod',sortable:true,width:670,header:_('modutilities.allowMethod'),editor:{xtype:'textfield'},renderer:defaultRenderer},{dataIndex:'BASIC_auth',sortable:true,width:670,header:_('modutilities.BASIC_auth'),renderer:function(val){if(val===1){val='<span class=\"true\">'+_('yes')+'</span>'}else{val='<span class=\"false\">'+_('no')+'</span>'}\nreturn val},editor:{xtype:'combo-boolean'},},],fields:['id','name','permission','param','allowMethod','BASIC_auth',],tbar:[{xtype:'button',text:_('category_create'),cls:'primary-button',handler:function(){MODx.load({xtype:'modUtil-window-addCat',}).show()},}],action:'mgr/rest/category/get',save_action:'mgr/rest/category/update',autosave:true,getMenu:function(grid,rowIndex){var m=[]\nm.push({text:_('delete'),grid:grid,rowIndex:rowIndex,handler:this.del})\nreturn m},del:function(){var cs=this.getSelectedAsList()\nvar self=this\nMODx.msg.confirm({title:_('delete'),text:_('confirm_remove'),url:modUtilConnector_url,params:{action:'mgr/rest/category/delete',id:cs,},listeners:{'success':{fn:function(r){if(!r.success){MODx.msg.status({title:_('undeleted'),message:'ÐžÑˆÐ¸Ð±ÐºÐ°',delay:3})}else{MODx.msg.status({title:_('delete'),message:'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾',delay:3})}\nself.refresh()},scope:true}}})}}]},{title:'log',id:'modx-tabs-log',items:[{html:'connection log',cls:'panel-desc',},{id:'log-main-table',xtype:'modUtil-grid',columns:[{dataIndex:'id',width:330,sortable:true,header:'id',renderer:defaultRenderer,editor:{xtype:'textarea'},},{dataIndex:'rest_id',width:330,sortable:true,header:_('modutilities.rest_id'),renderer:defaultRenderer,editor:{xtype:'textfield'}},{dataIndex:'input',width:670,header:_('modutilities.input'),renderer:JSONRenderer,editor:{xtype:'textarea'},},{dataIndex:'output',width:670,header:_('modutilities.output'),renderer:HTMLRenderer,editor:{xtype:'textarea'},},{dataIndex:'user',sortable:true,width:670,header:_('modutilities.user'),renderer:JSONRenderer,editor:{xtype:'textarea'},},{dataIndex:'time',sortable:true,width:670,header:_('modutilities.time'),renderer:defaultRenderer,editor:{xtype:'textarea'},},{dataIndex:'datetime',sortable:true,width:670,header:_('modutilities.datetime'),renderer:defaultRenderer,editor:{xtype:'textarea'},},],fields:['id','rest_id','input','output','user','time','datetime',],tbar:[{emptyText:_('search'),id:'search-field-log',xtype:'textfield',},{id:'search-button-log',xtype:'button',text:'ðŸ”Ž',cls:'primary-button',handler:function(){var v=Ext.getCmp('search-field-log').getValue()\nif(v&&v!=_('search')){Ext.util.Cookies.set('search_log',v)}else{Ext.util.Cookies.set('search_log','')\nExt.util.Cookies.clear('search_log')}\nExt.getCmp('log-main-table').refresh()},}],action:'mgr/rest/log/get',}]}]}]})\nmodUtil.panel.Home.superclass.constructor.call(this,config)}\nExt.extend(modUtil.panel.Home,MODx.Panel)\nExt.reg('modUtil-panel-home',modUtil.panel.Home)\nmodUtil.grid.ModGrid=function(config){config=config||{}\nExt.apply(config,{paging:true,autoHeight:true,viewConfig:{forceFit:true,scrollOffset:0},remoteSort:true,url:modUtilConnector_url,keyField:'id',getSelectedAsList:function(){var selects=this.getSelectionModel().getSelections()\nif(selects.length<=0)return false\nvar cs=''\nfor(var i=0;i<selects.length;i++){cs+=','+selects[i].data[this.keyField]}\ncs=cs.substr(1)\nreturn cs}})\nmodUtil.grid.ModGrid.superclass.constructor.call(this,config)}\nExt.extend(modUtil.grid.ModGrid,MODx.grid.Grid)\nExt.reg('modUtil-grid',modUtil.grid.ModGrid)\nmodUtil.window.modWindow=function(config){config=config||{}\nExt.applyIf(config,{title:'Create thing',width:window.innerWidth/100*50,saveBtnText:'Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ðŸ’¾',url:modUtilConnector_url,})\nmodUtil.window.modWindow.superclass.constructor.call(this,config)}\nExt.extend(modUtil.window.modWindow,MODx.Window)\nExt.reg('modUtil-window-modWindow',modUtil.window.modWindow)\nmodUtil.window.addRest=function(config){config=config||{}\nthis.ident=config.ident||'mecnewsletter'+Ext.id()\nExt.applyIf(config,{title:_('create_new')+' Rest',fields:[{xtype:'textfield',allowBlank:false,fieldLabel:_('service_url'),name:'url',id:'addRest-'+this.ident+'-url',anchor:'99%',value:null},{xtype:'modUtil-combo-modCombo',fieldLabel:_('snippet'),name:'snippet',id:'addRest-'+this.ident+'-snippet',anchor:'99%',value:null,forceSelection:false,fields:['id','name'],url:MODx.config.connector_url,baseParams:{action:'element/snippet/getlist',sort:'id',dir:'DESK',combo:1,},allowBlank:false,hiddenName:'snippet',valueField:'name',displayField:'name',tpl:new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t<strong>{name}</strong><small>({category_name})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>',{compiled:true})},{xtype:'textarea',fieldLabel:_('parameters'),name:'param',id:'addRest-'+this.ident+'-param',anchor:'99%',value:null},{xtype:'modUtil-combo-modComboSuper',fieldLabel:'Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹',name:'allowMethod',id:'addRest-'+this.ident+'-allowMethod',anchor:'99%',value:null,fields:['name'],valueField:'name',displayField:'name',hiddenName:'allowMethod',multiple:true,action:'mgr/rest/getlistallowmethod',},{xtype:'textarea',fieldLabel:_('permissions'),name:'permission',id:'addRest-'+this.ident+'-permission',anchor:'99%',},{xtype:'xcheckbox',fieldLabel:'Basic auth',boxLabel:_('yes'),name:'BASIC_auth',id:'addRest-'+this.ident+'-BASIC_auth',anchor:'99%',value:false},{xtype:'modUtil-combo-modCombo',fieldLabel:_('category'),name:'category',id:'addRest-'+this.ident+'-category',fields:['id','name','allowMethod'],defaultValue:'1',allowBlank:false,baseParams:{action:'mgr/rest/category/get',combo:1,sort:'id',dir:'DESK',},hiddenName:'category',valueField:'name',displayField:'name',autoSelect:true,tpl:new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t<strong>{name}</strong><small>({allowMethod})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>',{compiled:true})}],action:'mgr/rest/rest/create',listeners:{beforeSubmit:function(a){if(typeof a.allowMethod!=='string'&&a.allowMethod){var allowMethod=a.allowMethod.join()\nif(typeof allowMethod=='string'){$(`input[name=\"allowMethod\"]`).each(function(){$(this).val(allowMethod)\n$(this).attr('value',allowMethod)\nthis.value=allowMethod})}}\nreturn true},success:function(){MODx.msg.status({title:_('created'),message:'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾',delay:3})\nExt.getCmp('Rest-main-table').refresh()\nthis.remove()},failure:function(){this.remove()}}})\nmodUtil.window.addRest.superclass.constructor.call(this,config)}\nExt.extend(modUtil.window.addRest,modUtil.window.modWindow)\nExt.reg('modUtil-window-addRest',modUtil.window.addRest)\nmodUtil.window.addCat=function(config){config=config||{}\nthis.ident=config.ident||'mecnewsletter'+Ext.id()\nExt.applyIf(config,{title:_('create_new')+' Rest',fields:[{xtype:'textfield',fieldLabel:_('name'),name:'name',id:'addRest-'+this.ident+'-url',anchor:'99%',value:null},{xtype:'textarea',fieldLabel:_('parameters'),name:'param',id:'addRest-'+this.ident+'-param',anchor:'99%',value:null},{xtype:'modUtil-combo-modComboSuper',fieldLabel:'Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹',name:'allowMethod',id:'addCat-'+this.ident+'-allowMethod',anchor:'99%',value:null,fields:['name'],valueField:'name',displayField:'name',hiddenName:'allowMethod',multiple:true,action:'mgr/rest/getlistallowmethod',},{xtype:'textarea',fieldLabel:_('permissions'),name:'permission',id:'addRest-'+this.ident+'-permission',anchor:'99%',},{xtype:'xcheckbox',fieldLabel:'Basic auth',boxLabel:_('yes'),name:'BASIC_auth',id:'addRest-'+this.ident+'-BASIC_auth',anchor:'99%',value:false},],action:'mgr/rest/category/create',listeners:{beforeSubmit:function(a){if(typeof a.allowMethod!=='string'&&a.allowMethod){var allowMethod=a.allowMethod.join()\nif(typeof allowMethod=='string'){$(`input[name=\"allowMethod\"]`).each(function(){$(this).val(allowMethod)\n$(this).attr('value',allowMethod)\nthis.value=allowMethod})}}\nreturn true},success:function(){MODx.msg.status({title:_('created'),message:'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾',delay:3})\nExt.getCmp('Category-main-table').refresh()\nthis.remove()},failure:function(){this.remove()}}})\nmodUtil.window.addRest.superclass.constructor.call(this,config)}\nExt.extend(modUtil.window.addCat,modUtil.window.modWindow)\nExt.reg('modUtil-window-addCat',modUtil.window.addCat)\nmodUtil.combo.modCombo=function(config){config=config||{}\nthis.ident=config.ident||'mecnewsletter'+Ext.id()\nExt.applyIf(config,{url:modUtilConnector_url,valueField:'id',width:'100%',anchor:'99%',editable:true,pageSize:20,preventRender:true,forceSelection:true,enableKeyEvents:true,})\nmodUtil.combo.modCombo.superclass.constructor.call(this,config)}\nExt.extend(modUtil.combo.modCombo,MODx.combo.ComboBox)\nExt.reg('modUtil-combo-modCombo',modUtil.combo.modCombo)\nmodUtil.combo.modComboSuper=function(config){config=config||{}\nExt.applyIf(config,{xtype:'superboxselect',allowBlank:true,msgTarget:'under',allowAddNewData:true,addNewDataOnBlur:true,resizable:true,name:config.name||'tags',anchor:'99%',minChars:2,store:new Ext.data.JsonStore({id:(config.name||'tags')+'-store',root:'results',autoLoad:true,autoSave:false,totalProperty:'total',fields:config.fields,url:modUtilConnector_url,baseParams:{action:config.action,combo:1,key:config.name}}),mode:'remote',displayField:'value',valueField:'value',triggerAction:'all',extraItemCls:'x-tag',expandBtnCls:'x-form-trigger',clearBtnCls:'x-form-trigger',listeners:{newitem:function(bs,v,f){bs.addItem({tag:v})}},renderTo:Ext.getBody()})\nconfig.name+='[]'\nmodUtil.combo.modComboSuper.superclass.constructor.call(this,config)}\nExt.extend(modUtil.combo.modComboSuper,Ext.ux.form.SuperBoxSelect)\nExt.reg('modUtil-combo-modComboSuper',modUtil.combo.modComboSuper)\n\n"],"file":"snippet_rest.tab.min.js"}