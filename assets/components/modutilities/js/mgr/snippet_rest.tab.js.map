{"version":3,"names":[],"mappings":"","sources":["assets/components/modutilities/js/mgr/snippet_rest.tab.js"],"sourcesContent":["Ext.onReady(function() {\r\n\tExt.util.Cookies.set('search_log', '')\r\n\tMODx.add({\r\n\t\txtype: 'modUtil-panel-home'\r\n\t})\r\n\r\n\thljs.initHighlightingOnLoad()\r\n\tsetTimeout(function() {\r\n\t\tdocument.querySelectorAll('pre code').forEach((block) => {\r\n\t\t\tif(typeof hljs != 'undefined') {\r\n\t\t\t\thljs.highlightBlock(block)\r\n\t\t\t}\r\n\t\t})\r\n\t}, 1000)\r\n\r\n})\r\nvar entityMap = {\r\n\t'&': '&amp;',\r\n\t'<': '&lt;',\r\n\t'>': '&gt;',\r\n\t'\"': '&quot;',\r\n\t'\\'': '&#39;',\r\n\t'/': '&#x2F;',\r\n\t'`': '&#x60;',\r\n\t'=': '&#x3D;'\r\n}\r\n\r\nvar modUtil = function(config) {\r\n\tconfig = config || {}\r\n\tmodUtil.superclass.constructor.call(this, config)\r\n}\r\nExt.extend(modUtil, MODx.Component, { // Перечисляем группы, внутрь которых будем \"складывать\" объекты\r\n\tpanel: {},\r\n\tpage: {},\r\n\twindow: {},\r\n\tgrid: {},\r\n\ttree: {},\r\n\tcombo: {},\r\n\tconfig: {},\r\n\tview: {},\r\n\tutils: {}\r\n})\r\nExt.reg('modUtil', modUtil)\r\nmodUtil = new modUtil()\r\nvar escapeHTML = function(string) {\r\n\tvar htmlEscapes = {\r\n\t\t'&': '&amp;',\r\n\t\t'<': '&lt;',\r\n\t\t'>': '&gt;',\r\n\t\t'\"': '&quot;',\r\n\t\t'\\'': '&#x27;',\r\n\t\t'/': '&#x2F;'\r\n\t}\r\n\tvar htmlEscaper = /[&<>\"'\\/]/g\r\n\treturn ('' + string).replace(htmlEscaper, function(match) {\r\n\t\treturn htmlEscapes[match]\r\n\t})\r\n}\r\nvar defaultRenderer = function(val) {\r\n\tconsole.debug(arguments)\r\n\treturn val || _('ext_emptygroup')\r\n}\r\nvar JSONRenderer = function(val) {\r\n\tif(val) {\r\n\t\ttry {\r\n\t\t\treturn cope.Highlighter.highlight(JSON.parse(val), {indent: 2, useTabs: true})\r\n\t\t} finally {\r\n\t\t\treturn `<pre><code class=\"language-json\">${val}</code></pre>`\r\n\t\t}\r\n\t}\r\n\treturn defaultRenderer(val)\r\n}\r\n\r\nfunction escapeHtml(string) {\r\n\treturn String(string).replace(/[&<>\"'`=\\/]/g, function(s) {\r\n\t\treturn entityMap[s]\r\n\t})\r\n}\r\n\r\nvar HTMLRenderer = function(val) {\r\n\tif(val) {\r\n\t\tvar out = null\r\n\t\ttry {\r\n\t\t\tout = hljs.highlight('xml', val).value\r\n\t\t} catch(e) {\r\n\t\t\tout = '<code> ' + escapeHtml(defaultRenderer(val)) + ' </code>'\r\n\t\t}\r\n\t\treturn out\r\n\t}\r\n\treturn defaultRenderer(val)\r\n}\r\n\r\n//основной блок\r\nmodUtil.panel.Home = function(config) {\r\n\tconfig = config || {}\r\n\tExt.apply(config, {\r\n\t\tcls: 'container', // Добавляем отступы\r\n\t\titems: [{\r\n\t\t\thtml: ' <h2>modUtil REST<small style=\"font-size: 10px\"><a href=\"https://forms.gle/FJbfBSutMJwQCgmS8\" target=\"_blank\">Bug report</a></small></h2><br><small style=\"color: red\">deprecated interface, please install <strong><a>ExtraExt</a></strong> </small>',\r\n\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'modx-tabs',\r\n\t\t\t\tid: 'main-modx-tabs',\r\n\t\t\t\tdeferredRender: false,\r\n\t\t\t\tborder: true,\r\n\t\t\t\titems: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttitle: 'Rest',\r\n\t\t\t\t\t\tid: 'modx-tabs-Rest',\r\n\t\t\t\t\t\titems: [{\r\n\t\t\t\t\t\t\thtml: 'Methods',\r\n\t\t\t\t\t\t\tcls: 'panel-desc',\r\n\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\tid: 'Rest-main-table',\r\n\t\t\t\t\t\t\txtype: 'modUtil-grid',\r\n\t\t\t\t\t\t\tcolumns: [ // Добавляем ширину и заголовок столбца\r\n\t\t\t\t\t\t\t\t{dataIndex: 'id', width: 330, header: 'id', sortable: true, renderer: defaultRenderer},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'url',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: 'url',\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textfield'},\r\n\t\t\t\t\t\t\t\t\trenderer: function(val) {\r\n\t\t\t\t\t\t\t\t\t\tif(val) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn `<a href=\"/${val}\" target=\"_blank\">${val}</a>`\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\treturn defaultRenderer(val)\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'snippet',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('snippet'),\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\teditor: {\r\n\t\t\t\t\t\t\t\t\t\txtype: 'modUtil-combo-modCombo',\r\n\t\t\t\t\t\t\t\t\t\tfieldLabel: _('snippet'),\r\n\t\t\t\t\t\t\t\t\t\tforceSelection: false,\r\n\t\t\t\t\t\t\t\t\t\tfields: ['id', 'name', 'category_name'],\r\n\t\t\t\t\t\t\t\t\t\turl: MODx.config.connector_url,\r\n\t\t\t\t\t\t\t\t\t\tbaseParams: {\r\n\t\t\t\t\t\t\t\t\t\t\taction: 'element/snippet/getlist',\r\n\t\t\t\t\t\t\t\t\t\t\tsort: 'id',\r\n\t\t\t\t\t\t\t\t\t\t\tdir: 'DESK',\r\n\t\t\t\t\t\t\t\t\t\t\tcombo: 1,\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tvalueField: 'name',\r\n\t\t\t\t\t\t\t\t\t\tdisplayField: 'name',\r\n\t\t\t\t\t\t\t\t\t\ttpl: new Ext.XTemplate(\r\n\t\t\t\t\t\t\t\t\t\t\t'<tpl for=\".\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{name}</strong><small>({category_name})</small>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t\t\t\t\t\t</tpl>'\r\n\t\t\t\t\t\t\t\t\t\t\t, {compiled: true}\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'parameters',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t\theader: _('parameters'),\r\n\t\t\t\t\t\t\t\t\trenderer: JSONRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'permission',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('permissions'),\r\n\t\t\t\t\t\t\t\t\trenderer: JSONRenderer\r\n\t\t\t\t\t\t\t\t\t,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'allowMethod',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.allowMethod'),\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textfield'}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'BASIC_auth',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.BASIC_auth'),\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'combo-boolean'},\r\n\t\t\t\t\t\t\t\t\trenderer: function(val) {\r\n\t\t\t\t\t\t\t\t\t\tif(val == 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tval = '<span class=\"true\">' + _('yes') + '</span>'\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tval = '<span class=\"false\">' + _('no') + '</span>'\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn val\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'category', width: 670, header: _('category'),\r\n\t\t\t\t\t\t\t\t\teditor: {\r\n\t\t\t\t\t\t\t\t\t\txtype: 'modUtil-combo-modCombo',\r\n\t\t\t\t\t\t\t\t\t\tname: 'category',\r\n\t\t\t\t\t\t\t\t\t\thiddenName: 'category',\r\n\t\t\t\t\t\t\t\t\t\tfieldLabel: _('category'),\r\n\t\t\t\t\t\t\t\t\t\tforceSelection: false,\r\n\t\t\t\t\t\t\t\t\t\tfields: ['id', 'name', 'allowMethod'],\r\n\t\t\t\t\t\t\t\t\t\tbaseParams: {\r\n\t\t\t\t\t\t\t\t\t\t\taction: 'mgr/rest/category/get',\r\n\t\t\t\t\t\t\t\t\t\t\tsort: 'name',\r\n\t\t\t\t\t\t\t\t\t\t\tdir: 'DESK',\r\n\t\t\t\t\t\t\t\t\t\t\tcombo: 1,\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tvalueField: 'name',\r\n\t\t\t\t\t\t\t\t\t\tdisplayField: 'name',\r\n\t\t\t\t\t\t\t\t\t\ttpl: new Ext.XTemplate(\r\n\t\t\t\t\t\t\t\t\t\t\t'<tpl for=\".\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<strong>{name}</strong><small>({allowMethod})</small>\\\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t\t\t\t\t\t\t</tpl>'\r\n\t\t\t\t\t\t\t\t\t\t\t, {compiled: true}\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tfields: [\r\n\t\t\t\t\t\t\t\t'id',\r\n\t\t\t\t\t\t\t\t'permission',\r\n\t\t\t\t\t\t\t\t'url',\r\n\t\t\t\t\t\t\t\t'snippet',\r\n\t\t\t\t\t\t\t\t'param',\r\n\t\t\t\t\t\t\t\t'allowMethod',\r\n\t\t\t\t\t\t\t\t'BASIC_auth',\r\n\t\t\t\t\t\t\t\t'category',\r\n\t\t\t\t\t\t\t\t'catName',\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\ttbar: [{\r\n\t\t\t\t\t\t\t\txtype: 'button', // Перемещаем сюда нашу кнопку\r\n\t\t\t\t\t\t\t\ttext: _('create_new') + ' Rest',\r\n\t\t\t\t\t\t\t\tcls: 'primary-button',\r\n\t\t\t\t\t\t\t\thandler: function() {\r\n\t\t\t\t\t\t\t\t\tMODx.load({\r\n\t\t\t\t\t\t\t\t\t\txtype: 'modUtil-window-addRest',\r\n\t\t\t\t\t\t\t\t\t}).show()\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t}],\r\n\t\t\t\t\t\t\taction: 'mgr/rest/rest/get',\r\n\t\t\t\t\t\t\tsave_action: 'mgr/rest/rest/update',\r\n\t\t\t\t\t\t\tautosave: true,\r\n\t\t\t\t\t\t\tgetMenu: function(grid, rowIndex) {\r\n\t\t\t\t\t\t\t\tvar m = []\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('delete'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.del\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\treturn m\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tdel: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tMODx.msg.confirm({\r\n\t\t\t\t\t\t\t\t\ttitle: _('delete'),\r\n\t\t\t\t\t\t\t\t\ttext: _('confirm_remove'),\r\n\t\t\t\t\t\t\t\t\turl: modUtilConnector_url,\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\taction: 'mgr/rest/rest/delete',\r\n\t\t\t\t\t\t\t\t\t\tid: cs,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\t\t\t\t'success': {\r\n\t\t\t\t\t\t\t\t\t\t\tfn: function(r) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(!r.success) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: _('undeleted'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Ошибка',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: _('delete'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t}, scope: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttitle: 'Category',\r\n\t\t\t\t\t\tid: 'modx-tabs-Category',\r\n\t\t\t\t\t\titems: [{\r\n\t\t\t\t\t\t\thtml: 'Categories',\r\n\t\t\t\t\t\t\tcls: 'panel-desc',\r\n\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\tid: 'Category-main-table',\r\n\t\t\t\t\t\t\txtype: 'modUtil-grid',\r\n\t\t\t\t\t\t\tcolumns: [ // Добавляем ширину и заголовок столбца\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'id',\r\n\t\t\t\t\t\t\t\t\twidth: 330,\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\theader: 'id',\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'name',\r\n\t\t\t\t\t\t\t\t\twidth: 330,\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\theader: _('name'),\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textfield'}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'permission',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('permissions'),\r\n\t\t\t\t\t\t\t\t\trenderer: JSONRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'param', width: 670, header: _('parameters'),\r\n\t\t\t\t\t\t\t\t\trenderer: JSONRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'allowMethod',\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.allowMethod'),\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textfield'},\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'BASIC_auth',\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.BASIC_auth'),\r\n\t\t\t\t\t\t\t\t\trenderer: function(val) {\r\n\t\t\t\t\t\t\t\t\t\tif(val === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tval = '<span class=\"true\">' + _('yes') + '</span>'\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tval = '<span class=\"false\">' + _('no') + '</span>'\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn val\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'combo-boolean'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tfields: [\r\n\t\t\t\t\t\t\t\t'id',\r\n\t\t\t\t\t\t\t\t'name',\r\n\t\t\t\t\t\t\t\t'permission',\r\n\t\t\t\t\t\t\t\t'param',\r\n\t\t\t\t\t\t\t\t'allowMethod',\r\n\t\t\t\t\t\t\t\t'BASIC_auth',\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\ttbar: [{\r\n\t\t\t\t\t\t\t\txtype: 'button', // Перемещаем сюда нашу кнопку\r\n\t\t\t\t\t\t\t\ttext: _('category_create'),\r\n\t\t\t\t\t\t\t\tcls: 'primary-button',\r\n\t\t\t\t\t\t\t\thandler: function() {\r\n\t\t\t\t\t\t\t\t\tMODx.load({\r\n\t\t\t\t\t\t\t\t\t\txtype: 'modUtil-window-addCat',\r\n\t\t\t\t\t\t\t\t\t}).show()\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t}],\r\n\t\t\t\t\t\t\taction:'mgr/rest/category/get',\r\n\t\t\t\t\t\t\tsave_action:'mgr/rest/category/update',\r\n\t\t\t\t\t\t\tautosave: true,\r\n\t\t\t\t\t\t\tgetMenu: function(grid, rowIndex) {\r\n\t\t\t\t\t\t\t\tvar m = []\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('delete'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.del\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\treturn m\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tdel: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tMODx.msg.confirm({\r\n\t\t\t\t\t\t\t\t\ttitle: _('delete'),\r\n\t\t\t\t\t\t\t\t\ttext: _('confirm_remove'),\r\n\t\t\t\t\t\t\t\t\turl: modUtilConnector_url,\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\taction: 'mgr/rest/category/delete',\r\n\t\t\t\t\t\t\t\t\t\tid: cs,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\t\t\t\t'success': {\r\n\t\t\t\t\t\t\t\t\t\t\tfn: function(r) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(!r.success) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: _('undeleted'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Ошибка',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: _('delete'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t}, scope: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttitle: 'log',\r\n\t\t\t\t\t\tid: 'modx-tabs-log',\r\n\t\t\t\t\t\titems: [{ // Внутри таба ещё один HTML-блок с классом panel-desc\r\n\t\t\t\t\t\t\thtml: 'connection log',\r\n\t\t\t\t\t\t\tcls: 'panel-desc',\r\n\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\tid: 'log-main-table',\r\n\t\t\t\t\t\t\txtype: 'modUtil-grid',\r\n\t\t\t\t\t\t\tcolumns: [ // Добавляем ширину и заголовок столбца\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'id',\r\n\t\t\t\t\t\t\t\t\twidth: 330,\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\theader: 'id',\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'rest_id',\r\n\t\t\t\t\t\t\t\t\twidth: 330,\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.rest_id'),\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textfield'}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'input',\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.input'),\r\n\t\t\t\t\t\t\t\t\trenderer: JSONRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'output', width: 670, header: _('modutilities.output'),\r\n\t\t\t\t\t\t\t\t\trenderer: HTMLRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'user',\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.user'),\r\n\t\t\t\t\t\t\t\t\trenderer: JSONRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'time', sortable: true, width: 670, header: _('modutilities.time'),\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdataIndex: 'datetime',\r\n\t\t\t\t\t\t\t\t\tsortable: true,\r\n\t\t\t\t\t\t\t\t\twidth: 670,\r\n\t\t\t\t\t\t\t\t\theader: _('modutilities.datetime'),\r\n\t\t\t\t\t\t\t\t\trenderer: defaultRenderer,\r\n\t\t\t\t\t\t\t\t\teditor: {xtype: 'textarea'},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tfields: [\r\n\t\t\t\t\t\t\t\t'id',\r\n\t\t\t\t\t\t\t\t'rest_id',\r\n\t\t\t\t\t\t\t\t'input',\r\n\t\t\t\t\t\t\t\t'output',\r\n\t\t\t\t\t\t\t\t'user',\r\n\t\t\t\t\t\t\t\t'time',\r\n\t\t\t\t\t\t\t\t'datetime',\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\ttbar: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\temptyText: _('search'),\r\n\t\t\t\t\t\t\t\t\tid: 'search-field-log',\r\n\t\t\t\t\t\t\t\t\txtype: 'textfield', // Перемещаем сюда нашу кнопку\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tid: 'search-button-log',\r\n\t\t\t\t\t\t\t\t\txtype: 'button', // Перемещаем сюда нашу кнопку\r\n\t\t\t\t\t\t\t\t\ttext: '🔎',\r\n\t\t\t\t\t\t\t\t\tcls: 'primary-button',\r\n\t\t\t\t\t\t\t\t\thandler: function() {\r\n\t\t\t\t\t\t\t\t\t\tvar v = Ext.getCmp('search-field-log').getValue()\r\n\t\t\t\t\t\t\t\t\t\tif(v && v != _('search')) {\r\n\t\t\t\t\t\t\t\t\t\t\tExt.util.Cookies.set('search_log', v)\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tExt.util.Cookies.set('search_log', '')\r\n\t\t\t\t\t\t\t\t\t\t\tExt.util.Cookies.clear('search_log')\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tExt.getCmp('log-main-table').refresh()\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t}],\r\n\t\t\t\t\t\t\taction: 'mgr/rest/log/get',\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t})\r\n\tmodUtil.panel.Home.superclass.constructor.call(this, config) // Чёртова магия =)\r\n}\r\n\r\nExt.extend(modUtil.panel.Home, MODx.Panel)\r\nExt.reg('modUtil-panel-home', modUtil.panel.Home)\r\n\r\nmodUtil.grid.ModGrid = function(config) { // Придумываем название, например, «Names»\r\n\tconfig = config || {}\r\n\tExt.apply(config, {\r\n\t\t// Сюда перемещаем все свойства нашей таблички\r\n\t\tpaging: true,\r\n\t\tautoHeight: true,\r\n\t\tviewConfig: {\r\n\t\t\tforceFit: true,\r\n\t\t\tscrollOffset: 0\r\n\t\t},\r\n\t\tremoteSort: true,\r\n\t\turl: modUtilConnector_url,\r\n\t\tkeyField: 'id',\r\n\t\tgetSelectedAsList: function() {\r\n\t\t\tvar selects = this.getSelectionModel().getSelections()\r\n\t\t\tif(selects.length <= 0) return false\r\n\t\t\tvar cs = ''\r\n\t\t\tfor(var i = 0; i < selects.length; i++) {\r\n\t\t\t\tcs += ',' + selects[i].data[this.keyField]\r\n\t\t\t}\r\n\t\t\tcs = cs.substr(1)\r\n\t\t\treturn cs\r\n\t\t}\r\n\t})\r\n\tmodUtil.grid.ModGrid.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(modUtil.grid.ModGrid, MODx.grid.Grid) // Наша табличка расширяет GridPanel\r\nExt.reg('modUtil-grid', modUtil.grid.ModGrid) // Регистрируем новый xtype\r\n\r\nmodUtil.window.modWindow = function(config) {\r\n\tconfig = config || {}\r\n\tExt.applyIf(config, {\r\n\t\ttitle: 'Create thing',\r\n\t\twidth: window.innerWidth / 100 * 50,\r\n\t\tsaveBtnText: 'Сохранить 💾',\r\n\t\turl: modUtilConnector_url,\r\n\r\n\t})\r\n\tmodUtil.window.modWindow.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(modUtil.window.modWindow, MODx.Window) // Расширяем MODX.Window\r\nExt.reg('modUtil-window-modWindow', modUtil.window.modWindow) // Регистрируем новый xtype\r\n//добавление rest\r\n\r\nmodUtil.window.addRest = function(config) {\r\n\tconfig = config || {}\r\n\tthis.ident = config.ident || 'mecnewsletter' + Ext.id()\r\n\tExt.applyIf(config, {\r\n\t\ttitle: _('create_new') + ' Rest',\r\n\t\tfields: [\r\n\t\t\t{\r\n\t\t\t\txtype: 'textfield',\r\n\t\t\t\tallowBlank: false,\r\n\t\t\t\tfieldLabel: _('service_url'),\r\n\t\t\t\tname: 'url',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-url',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'modUtil-combo-modCombo',\r\n\t\t\t\tfieldLabel: _('snippet'),\r\n\t\t\t\tname: 'snippet',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-snippet',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null,\r\n\t\t\t\tforceSelection: false,\r\n\t\t\t\tfields: ['id', 'name'],\r\n\t\t\t\turl: MODx.config.connector_url,\r\n\t\t\t\tbaseParams: {\r\n\t\t\t\t\taction: 'element/snippet/getlist',\r\n\t\t\t\t\tsort: 'id',\r\n\t\t\t\t\tdir: 'DESK',\r\n\t\t\t\t\tcombo: 1,\r\n\t\t\t\t},\r\n\t\t\t\tallowBlank: false,\r\n\t\t\t\thiddenName: 'snippet',\r\n\t\t\t\tvalueField: 'name',\r\n\t\t\t\tdisplayField: 'name',\r\n\t\t\t\ttpl: new Ext.XTemplate(\r\n\t\t\t\t\t'<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t<strong>{name}</strong><small>({category_name})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>'\r\n\t\t\t\t\t, {compiled: true}\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'textarea',\r\n\t\t\t\tfieldLabel: _('parameters'),\r\n\t\t\t\tname: 'param',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-param',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'modUtil-combo-modComboSuper',\r\n\t\t\t\tfieldLabel: 'разрешенные методы',\r\n\t\t\t\tname: 'allowMethod',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-allowMethod',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null,\r\n\t\t\t\tfields: ['name'],\r\n\t\t\t\tvalueField: 'name',\r\n\t\t\t\tdisplayField: 'name',\r\n\t\t\t\thiddenName: 'allowMethod',\r\n\t\t\t\tmultiple: true,\r\n\t\t\t\taction: 'mgr/rest/getlistallowmethod',\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'textarea',\r\n\t\t\t\tfieldLabel: _('permissions'),\r\n\t\t\t\tname: 'permission',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-permission',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tfieldLabel: 'Basic auth',\r\n\t\t\t\tboxLabel: _('yes'),\r\n\t\t\t\tname: 'BASIC_auth',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-BASIC_auth',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: false\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'modUtil-combo-modCombo',\r\n\t\t\t\tfieldLabel: _('category'),\r\n\t\t\t\tname: 'category',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-category',\r\n\t\t\t\tfields: ['id', 'name', 'allowMethod'],\r\n\t\t\t\tdefaultValue: '1',\r\n\t\t\t\tallowBlank: false,\r\n\t\t\t\tbaseParams: {\r\n\t\t\t\t\taction: 'mgr/rest/category/get',\r\n\t\t\t\t\tcombo: 1,\r\n\t\t\t\t\tsort: 'id',\r\n\t\t\t\t\tdir: 'DESK',\r\n\t\t\t\t},\r\n\t\t\t\thiddenName: 'category',\r\n\t\t\t\tvalueField: 'name',\r\n\t\t\t\tdisplayField: 'name',\r\n\t\t\t\tautoSelect: true,\r\n\t\t\t\ttpl: new Ext.XTemplate(\r\n\t\t\t\t\t'<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t<strong>{name}</strong><small>({allowMethod})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>'\r\n\t\t\t\t\t, {compiled: true}\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t],\r\n\t\taction: 'mgr/rest/rest/create',\r\n\t\tlisteners: {\r\n\t\t\tbeforeSubmit: function(a) {\r\n\t\t\t\tif(typeof a.allowMethod !== 'string' && a.allowMethod) {\r\n\t\t\t\t\tvar allowMethod = a.allowMethod.join()\r\n\t\t\t\t\tif(typeof allowMethod == 'string') {\r\n\t\t\t\t\t\t$(`input[name=\"allowMethod\"]`).each(function() {\r\n\t\t\t\t\t\t\t$(this).val(allowMethod)\r\n\t\t\t\t\t\t\t$(this).attr('value', allowMethod)\r\n\t\t\t\t\t\t\tthis.value = allowMethod\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t},\r\n\t\t\tsuccess: function() {\r\n\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\ttitle: _('created'),\r\n\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\tdelay: 3\r\n\t\t\t\t})\r\n\t\t\t\tExt.getCmp('Rest-main-table').refresh()\r\n\t\t\t\tthis.remove()\r\n\t\t\t},\r\n\t\t\tfailure: function() {\r\n\t\t\t\tthis.remove()\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tmodUtil.window.addRest.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(modUtil.window.addRest, modUtil.window.modWindow) // Расширяем MODX.Window\r\nExt.reg('modUtil-window-addRest', modUtil.window.addRest) // Регистрируем новый xtype\r\n//добавление категории\r\n\r\nmodUtil.window.addCat = function(config) {\r\n\tconfig = config || {}\r\n\tthis.ident = config.ident || 'mecnewsletter' + Ext.id()\r\n\tExt.applyIf(config, {\r\n\t\ttitle: _('create_new') + ' Rest',\r\n\t\tfields: [\r\n\t\t\t{\r\n\t\t\t\txtype: 'textfield',\r\n\t\t\t\tfieldLabel: _('name'),\r\n\t\t\t\tname: 'name',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-url',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'textarea',\r\n\t\t\t\tfieldLabel: _('parameters'),\r\n\t\t\t\tname: 'param',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-param',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'modUtil-combo-modComboSuper',\r\n\t\t\t\tfieldLabel: 'разрешенные методы',\r\n\t\t\t\tname: 'allowMethod',\r\n\t\t\t\tid: 'addCat-' + this.ident + '-allowMethod',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: null,\r\n\t\t\t\tfields: ['name'],\r\n\t\t\t\tvalueField: 'name',\r\n\t\t\t\tdisplayField: 'name',\r\n\t\t\t\thiddenName: 'allowMethod',\r\n\t\t\t\tmultiple: true,\r\n\t\t\t\taction: 'mgr/rest/getlistallowmethod',\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'textarea',\r\n\t\t\t\tfieldLabel: _('permissions'),\r\n\t\t\t\tname: 'permission',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-permission',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tfieldLabel: 'Basic auth',\r\n\t\t\t\tboxLabel: _('yes'),\r\n\t\t\t\tname: 'BASIC_auth',\r\n\t\t\t\tid: 'addRest-' + this.ident + '-BASIC_auth',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: false\r\n\t\t\t},\r\n\t\t],\r\n\t\taction: 'mgr/rest/category/create',\r\n\t\tlisteners: {\r\n\t\t\tbeforeSubmit: function(a) {\r\n\t\t\t\tif(typeof a.allowMethod !== 'string' && a.allowMethod) {\r\n\t\t\t\t\tvar allowMethod = a.allowMethod.join()\r\n\t\t\t\t\tif(typeof allowMethod == 'string') {\r\n\t\t\t\t\t\t$(`input[name=\"allowMethod\"]`).each(function() {\r\n\t\t\t\t\t\t\t$(this).val(allowMethod)\r\n\t\t\t\t\t\t\t$(this).attr('value', allowMethod)\r\n\t\t\t\t\t\t\tthis.value = allowMethod\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t},\r\n\t\t\tsuccess: function() {\r\n\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\ttitle: _('created'),\r\n\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\tdelay: 3\r\n\t\t\t\t})\r\n\t\t\t\tExt.getCmp('Category-main-table').refresh()\r\n\t\t\t\tthis.remove()\r\n\t\t\t},\r\n\t\t\tfailure: function() {\r\n\t\t\t\tthis.remove()\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tmodUtil.window.addRest.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(modUtil.window.addCat, modUtil.window.modWindow) // Расширяем MODX.Window\r\nExt.reg('modUtil-window-addCat', modUtil.window.addCat) // Регистрируем новый xtype\r\n\r\nmodUtil.combo.modCombo = function(config) {\r\n\tconfig = config || {}\r\n\tthis.ident = config.ident || 'mecnewsletter' + Ext.id()\r\n\tExt.applyIf(config, {\r\n\t\turl: modUtilConnector_url,\r\n\t\tvalueField: 'id',\r\n\t\twidth: '100%',\r\n\t\tanchor: '99%',\r\n\t\teditable: true,\r\n\t\tpageSize: 20,\r\n\t\tpreventRender: true,\r\n\t\tforceSelection: true,\r\n\t\tenableKeyEvents: true,\r\n\t})\r\n\tmodUtil.combo.modCombo.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(modUtil.combo.modCombo, MODx.combo.ComboBox) // Расширяем MODX.ComboBox\r\nExt.reg('modUtil-combo-modCombo', modUtil.combo.modCombo) // Регистрируем новый xtype\r\n\r\nmodUtil.combo.modComboSuper = function(config) {\r\n\tconfig = config || {}\r\n\tExt.applyIf(config, {\r\n\t\txtype: 'superboxselect'\r\n\t\t, allowBlank: true\r\n\t\t, msgTarget: 'under'\r\n\t\t, allowAddNewData: true\r\n\t\t, addNewDataOnBlur: true\r\n\t\t, resizable: true\r\n\t\t, name: config.name || 'tags'\r\n\t\t, anchor: '99%'\r\n\t\t, minChars: 2\r\n\t\t, store: new Ext.data.JsonStore({\r\n\t\t\tid: (config.name || 'tags') + '-store'\r\n\t\t\t, root: 'results'\r\n\t\t\t, autoLoad: true\r\n\t\t\t, autoSave: false\r\n\t\t\t, totalProperty: 'total'\r\n\t\t\t, fields: config.fields\r\n\t\t\t, url: modUtilConnector_url\r\n\t\t\t, baseParams: {\r\n\t\t\t\taction: config.action,\r\n\t\t\t\tcombo: 1,\r\n\t\t\t\tkey: config.name\r\n\t\t\t}\r\n\t\t})\r\n\t\t, mode: 'remote'\r\n\t\t, displayField: 'value'\r\n\t\t, valueField: 'value'\r\n\t\t, triggerAction: 'all'\r\n\t\t, extraItemCls: 'x-tag'\r\n\t\t, expandBtnCls: 'x-form-trigger'\r\n\t\t, clearBtnCls: 'x-form-trigger'\r\n\t\t, listeners: {\r\n\t\t\tnewitem: function(bs, v, f) {bs.addItem({tag: v})}\r\n\t\t\t/*,select: {fn:MODx.fireResourceFormChange, scope:this}\r\n\t\t\t,beforeadditem: {fn:MODx.fireResourceFormChange, scope:this}\r\n\t\t\t,beforeremoveitem: {fn:MODx.fireResourceFormChange, scope:this}\r\n\t\t\t,clear: {fn:MODx.fireResourceFormChange, scope:this}*/\r\n\t\t}\r\n\t\t, renderTo: Ext.getBody()\r\n\t})\r\n\tconfig.name += '[]'\r\n\tmodUtil.combo.modComboSuper.superclass.constructor.call(this, config)\r\n}\r\nExt.extend(modUtil.combo.modComboSuper, Ext.ux.form.SuperBoxSelect)\r\nExt.reg('modUtil-combo-modComboSuper', modUtil.combo.modComboSuper)\r\n\r\n\r\n\r\n"],"file":"snippet_rest.tab.js"}